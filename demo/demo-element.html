<!--
@license
Copyright (c) 2017 Ars Nebula LLC.
This code may be used under the terms found in LICENSE.md of this repository.
-->

<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../nebula-element-mixin.html">

<dom-module id="demo-element">
  <template>
    <style>
      :host {
        display: inline-block;
        padding: 32px;
        border: 1px solid red;
      }
    </style>
    <input type="text" value="{{message::input}}" />
    <p>Length: {{length}}</p>
    <button on-click="_onMessage">Message</button>
    <button on-click="_onListen">Listen</button>
    <button on-click="_onUnlisten">Unlisten</button>
    <button on-click="_onFire">Fire</button>
  </template>
  <script>
  (function() {
    const onResize = Symbol()

    class DemoElement extends Nebula.ElementMixin(Polymer.Element) {
      static get is() { return 'demo-element' }

      static get properties() {
        return {
          message: String,
          length: {
            type: Number,
            notify: true
          }
        }
      }

      constructor() {
        super()
        this.observe('message', this._onMessage)
        this.compute('length',  'message', this._computeLength)
      }

      ready() {
        super.ready();
        this.listen(this, 'test', console.log)
      }

      _computeLength(message) {
        if (message) {
          return message.length
        }        
      }

      _onMessage(message) {
        console.log(message)
      }

      _onListen() {
        this.listen(this, 'mousemove', this._onMouseMove)
        this.listen(this, 'resize', this[onResize])
      }

      _onUnlisten() {
        this.unlisten(this, 'mousemove')
        this.unlisten(window, 'resize')
      }

      _onFire() {
        this.fire('test', {message: 'Hello World'}, {bubbles: false})
      }

      _onMouseMove(e) {
        this.debounce('mousemove', function() {
          console.log(e, this)
        }, 500)
      }

      [onResize](e) {
        this.debounce('resize', function() {
          console.log(e, this)
        }, 5000)
      }

    }
    customElements.define(DemoElement.is, DemoElement)
    
  }())
  </script>
</dom-module>