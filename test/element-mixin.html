<!doctype html>

<html>
  <head>
    <title>nebula-element-mixin</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="../../iron-test-helpers/iron-test-helpers.html">
    <link rel="import" href="test-element.html">
  </head>
  <body>
    <test-fixture id="basic">
      <template>
        <test-element></test-element>
      </template>
    </test-fixture>

    <script>
      suite('basic', function() {
        var el
        setup(function() {
          el = fixture('basic')
        })
        test('element is upgraded', function() {
          assert.equal(el.constructor.is, 'test-element')
        })
        test('element has debounce', function(done) {
          el.debounce('test', function() {
            assert.equal(this, el)
            done()
          })
        })
        test('element has fire', function(done) {
          const detail = {message: 'test'}
          el.addEventListener('test', (e) => {
            assert.instanceOf(e, CustomEvent)
            assert.equal(e.type, 'test')
            assert.equal(e.detail, detail)
            assert.isFalse(e.bubbles)
            done()
          })
          el.fire('test', detail, {bubbles: false})
        })
        test('element has observer', function(done) {
          el.observe('message', ['message'], (message) => {
            assert(el.message, message)
            done()
          })
          el.message = "test"
        })
        test('element has listen', function(done) {
          el.listen(el, 'test', function() {
            assert.equal(this, el)
            done()
          })
          el.dispatchEvent(new Event('test'))
        })
        test('element has unlisten', function(done) {
          el.listen(el, 'test', function() {
            assert.fail('Test event received', 'Test event not received')
            done()
          })
          el.unlisten(el, 'test')
          el.dispatchEvent(new Event('test'))
          setTimeout(() => {
            done()
          }, 100)
        })
      })
    </script>
  </body>
</html>
